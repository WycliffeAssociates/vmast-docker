/*!
 * wavesurfer.js markers plugin 6.2.0 (2022-05-16)
 * https://wavesurfer-js.org
 * @license BSD-3-Clause
 */ !function(b,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define("WaveSurfer",[],a):"object"==typeof exports?exports.WaveSurfer=a():(b.WaveSurfer=b.WaveSurfer||{},b.WaveSurfer.markers=a())}(self,()=>(()=>{"use strict";var b,c={"./src/plugin/markers/index.js"(b,a){function d(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var c=function(){var a,b,c;function e(a,b){var c=this;!function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=a,this.wavesurfer=b,this.util=b.util,this.style=this.util.style,this.markerLineWidth=1,this.markerWidth=a.markerWidth||11,this.markerHeight=a.markerHeight||22,this.dragging=!1,this._onResize=function(){c._updateMarkerPositions()},this._onBackendCreated=function(){c.wrapper=c.wavesurfer.drawer.wrapper,c.params.markers&&c.params.markers.forEach(function(a){return c.add(a)}),window.addEventListener("resize",c._onResize,!0),window.addEventListener("orientationchange",c._onResize,!0),c.wavesurfer.on("zoom",c._onResize),c.markers.find(function(a){return a.draggable})&&(c.onMouseMove=function(a){return c._onMouseMove(a)},window.addEventListener("mousemove",c.onMouseMove),c.onMouseUp=function(a){return c._onMouseUp(a)},window.addEventListener("mouseup",c.onMouseUp))},this.markers=[],this._onReady=function(){c.wrapper=c.wavesurfer.drawer.wrapper,c._updateMarkerPositions()}}return a=e,b=[{key:"init",value:function(){this.wavesurfer.isReady?(this._onBackendCreated(),this._onReady()):(this.wavesurfer.once("ready",this._onReady),this.wavesurfer.once("backend-created",this._onBackendCreated))}},{key:"destroy",value:function(){this.wavesurfer.un("ready",this._onReady),this.wavesurfer.un("backend-created",this._onBackendCreated),this.wavesurfer.un("zoom",this._onResize),window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0),this.onMouseMove&&window.removeEventListener("mousemove",this.onMouseMove),this.onMouseUp&&window.removeEventListener("mouseup",this.onMouseUp),this.clear()}},{key:"add",value:function(a){var b={time:a.time,label:a.label,color:a.color||"#D8D8D8",position:a.position||"bottom",draggable:!!a.draggable};return b.el=this._createMarkerElement(b,a.markerElement),this.wrapper.appendChild(b.el),this.markers.push(b),this._updateMarkerPositions(),b}},{key:"remove",value:function(a){var b=this.markers[a];b&&(this.wrapper.removeChild(b.el),this.markers.splice(a,1))}},{key:"_createPointerSVG",value:function(d,e){var c="http://www.w3.org/2000/svg",b=document.createElementNS(c,"svg"),a=document.createElementNS(c,"polygon");return b.setAttribute("viewBox","0 0 40 80"),a.setAttribute("id","polygon"),a.setAttribute("stroke","#979797"),a.setAttribute("fill",d),a.setAttribute("points","20 0 40 30 40 80 0 80 0 30"),"top"==e&&a.setAttribute("transform","rotate(180, 20 40)"),b.appendChild(a),this.style(b,{width:this.markerWidth+"px",height:this.markerHeight+"px","min-width":this.markerWidth+"px","margin-right":"5px","z-index":4}),b}},{key:"_createMarkerElement",value:function(a,d){var j=this,f=a.label,c=document.createElement("marker");c.className="wavesurfer-marker",this.style(c,{position:"absolute",height:"100%",display:"flex",overflow:"hidden","flex-direction":"top"==a.position?"column-reverse":"column"});var g=document.createElement("div"),i=d&&d.width||this.markerWidth;a.offset=(i-this.markerLineWidth)/2,this.style(g,{"flex-grow":1,"margin-left":a.offset+"px",background:"black",width:this.markerLineWidth+"px",opacity:.1}),c.appendChild(g);var b=document.createElement("div"),h=d||this._createPointerSVG(a.color,a.position);if(a.draggable&&(h.draggable=!1),b.appendChild(h),f){var e=document.createElement("span");e.innerText=f,this.style(e,{"font-family":"monospace","font-size":"90%"}),b.appendChild(e)}return this.style(b,{display:"flex","align-items":"center",cursor:"pointer"}),c.appendChild(b),b.addEventListener("click",function(b){b.stopPropagation(),j.dragging||(j.wavesurfer.setCurrentTime(a.time),j.wavesurfer.fireEvent("marker-click",a,b))}),a.draggable&&b.addEventListener("mousedown",function(b){j.selectedMarker=a}),c}},{key:"_updateMarkerPositions",value:function(){for(var a=0;a<this.markers.length;a++){var b=this.markers[a];this._updateMarkerPosition(b)}}},{key:"_updateMarkerPosition",value:function(a){var d=this.wavesurfer.getDuration(),b=this.wavesurfer.drawer.width/this.wavesurfer.params.pixelRatio,c=b*Math.min(a.time/d,1)-a.offset;this.style(a.el,{left:c+"px","max-width":b-c+"px"})}},{key:"_onMouseMove",value:function(a){this.selectedMarker&&(this.dragging||(this.dragging=!0,this.wavesurfer.fireEvent("marker-drag",this.selectedMarker,a)),this.selectedMarker.time=this.wavesurfer.drawer.handleEvent(a)*this.wavesurfer.getDuration(),this._updateMarkerPositions())}},{key:"_onMouseUp",value:function(a){var c=this;if(this.selectedMarker&&setTimeout(function(){c.selectedMarker=!1,c.dragging=!1},0),this.dragging){a.stopPropagation();var b=this.wavesurfer.getDuration();this.selectedMarker.time=this.wavesurfer.drawer.handleEvent(a)*b,this._updateMarkerPositions(),this.wavesurfer.fireEvent("marker-drop",this.selectedMarker,a)}}},{key:"clear",value:function(){for(;this.markers.length>0;)this.remove(0)}}],c=[{key:"create",value:function(a){return{name:"markers",deferInit:!!a&&!!a.deferInit&&a.deferInit,params:a,staticProps:{addMarker:function(a){return this.initialisedPluginList.markers||this.initPlugin("markers"),this.markers.add(a)},clearMarkers:function(){this.markers&&this.markers.clear()}},instance:e}}}],b&&d(a.prototype,b),c&&d(a,c),Object.defineProperty(a,"prototype",{writable:!1}),e}();a.default=c,b.exports=a.default}},d={};function a(b){var f=d[b];if(void 0!==f)return f.exports;var e=d[b]={exports:{}};return c[b](e,e.exports,a),e.exports}return a("./src/plugin/markers/index.js")})())